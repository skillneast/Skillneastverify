<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Head section bilkul pehle jaisa hai... -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Access Key Generator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* CSS section bilkul pehle jaisa hai... */
        :root { --background-color: #0d0f1a; --card-background-color: rgba(28, 30, 48, 0.75); --text-color-primary: #f0f0f5; --text-color-secondary: #a0a0b0; --accent-gradient-start: #00d2ff; --accent-gradient-end: #d122e3; --success-color: #28a745; --glow-color-soft: rgba(209, 34, 227, 0.2); --card-border-color: rgba(255, 255, 255, 0.15); }
        body { margin: 0; font-family: 'Exo 2', sans-serif; background-color: var(--background-color); color: var(--text-color-primary); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        #particles-js { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; }
        .main-container, .success-page-container { width: 100%; max-width: 450px; z-index: 1; display: none; } /* Initially hide both */
        .header { display: flex; align-items: center; margin-bottom: 20px; justify-content: space-between; }
        .header h1 { font-size: 1.2rem; margin: 0; flex-grow: 1; text-align: center; font-weight: 600; color: var(--text-color-secondary); }
        .close-btn { font-size: 1.5rem; cursor: pointer; color: var(--text-color-secondary); }
        .generator-card, .how-to-card { background-color: var(--card-background-color); border-radius: 25px; padding: 30px; border: 1px solid var(--card-border-color); backdrop-filter: blur(15px); text-align: center; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5); }
        .generator-card .icon-container { width: 80px; height: 80px; background: linear-gradient(145deg, var(--accent-gradient-start), var(--accent-gradient-end)); border-radius: 50%; display: flex; justify-content: center; align-items: center; margin: 0 auto 20px auto; }
        .generator-card .icon-container .fa-key { font-size: 36px; color: white; }
        .generator-card h2 { font-size: 2.5rem; margin: 0 0 10px 0; font-weight: 800; background: linear-gradient(90deg, var(--accent-gradient-start), var(--accent-gradient-end)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .generator-card .subtitle { color: var(--text-color-secondary); margin-bottom: 30px; font-size: 1.1rem; }
        .info-cards-container { background-color: rgba(0, 0, 0, 0.3); border-radius: 20px; padding: 15px; margin-bottom: 30px; }
        .info-card { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--card-border-color); }
        .info-card:last-child { border-bottom: none; }
        .info-card .info-icon { color: var(--text-color-secondary); width: 30px; }
        .info-card .info-label { color: var(--text-color-secondary); flex-grow: 1; text-align: left; }
        .info-card .info-value { font-weight: 700; font-size: 1.1rem; }
        .generate-button { display: block; width: 100%; padding: 18px; border: none; border-radius: 15px; background: linear-gradient(90deg, var(--accent-gradient-start), var(--accent-gradient-end)); color: white; font-size: 1.2rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease-in-out; text-decoration: none; }
        .how-to-card { text-align: left; }
        .how-to-card h3 { font-size: 1.5rem; display: flex; align-items: center; gap: 12px; }
        .how-to-card h3 .fa-thumbs-up { color: var(--accent-gradient-start); }
        .how-to-card .subtitle { color: var(--text-color-secondary); margin-bottom: 20px; font-size: 1.1rem; }
        .tutorial-button { display: block; width: 100%; padding: 15px; margin-bottom: 25px; border-radius: 15px; text-decoration: none; color: var(--text-color-primary); font-weight: 600; text-align: center; cursor: pointer; background: linear-gradient(var(--card-background-color), var(--card-background-color)) padding-box, linear-gradient(90deg, var(--accent-gradient-start), var(--accent-gradient-end)) border-box; border: 2px solid transparent; }
        .tutorial-button i { margin-right: 8px; }
        .divider { border: none; height: 1px; background-color: var(--card-border-color); margin: 0 0 25px 0; }
        .instructions-list { list-style: none; padding: 0; margin: 0; text-align: left; }
        .instructions-list li { display: flex; align-items: center; margin-bottom: 20px; gap: 18px; }
        .instructions-list .instruction-icon { font-size: 1.1rem; flex-shrink: 0; }
        .icon-lightbulb { color: #ffc107; } .icon-target { color: #dc3545; } .icon-warning { color: #ffc107; }
        .success-card { background-color: var(--card-background-color); border-radius: 25px; padding: 40px; border: 1px solid var(--card-border-color); backdrop-filter: blur(15px); text-align: center; }
        .success-card .success-icon { font-size: 60px; color: var(--success-color); margin-bottom: 20px; }
        .success-card h2 { font-size: 2.2rem; margin: 0 0 10px 0; color: var(--success-color); font-weight: 800; }
        .success-card p { color: var(--text-color-secondary); font-size: 1.1rem; line-height: 1.6; }
        .access-key-box { background-color: rgba(0,0,0,0.4); padding: 20px; border-radius: 15px; font-size: 1.5rem; font-weight: 700; letter-spacing: 2px; margin: 25px 0; user-select: all; border: 1px dashed var(--card-border-color); color: var(--text-color-primary); }
        .copy-button { display: inline-flex; align-items: center; gap: 10px; background-color: var(--success-color); color: white; border: none; padding: 12px 25px; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
        .copy-button:hover { background-color: #218838; }
        .expiry-note { font-size: 0.9rem; margin-top: 25px; color: var(--text-color-secondary); opacity: 0.8; }
    </style>
</head>
<body>
    <div id="particles-js"></div>
    <!-- Generator Page -->
    <div class="main-container" id="generatorPage">
        <!-- HTML structure bilkul pehle jaisi hai... -->
        <div class="header"> <i class="fas fa-times close-btn"></i> <h1>Generate Access Key</h1> <div style="width: 24px;"></div> </div>
        <div class="generator-card">
            <div class="icon-container"><i class="fas fa-key"></i></div>
            <h2>Access Key Generator</h2>
            <p class="subtitle">Generate your secure access key instantly</p>
            <div class="info-cards-container">
                <div class="info-card"><i class="fas fa-clock info-icon"></i><span class="info-label">Validity</span><span class="info-value" id="validityDisplay">Loading...</span></div>
                <div class="info-card"><i class="fas fa-bolt info-icon"></i><span class="info-label">Generation</span><span class="info-value">Instant</span></div>
                <div class="info-card"><i class="fas fa-shield-halved info-icon"></i><span class="info-label">Security</span><span class="info-value">Advanced</span></div>
            </div>
            <button class="generate-button" id="generateButton">Generate Access Key</button>
        </div>
        <div class="how-to-card">
            <h3><i class="fa-solid fa-thumbs-up"></i> How to Generate Key</h3>
            <p class="subtitle">Watch this quick tutorial to learn the process</p>
            <a id="tutorialLink" href="#" class="tutorial-button" target="_blank" rel="noopener noreferrer"> <i class="fas fa-play-circle"></i> Watch Tutorial </a>
            <hr class="divider">
            <ul class="instructions-list"> <li><i class="fa-solid fa-lightbulb instruction-icon icon-lightbulb"></i><span>Watch the tutorial before generating your key</span></li> <li><i class="fa-solid fa-bullseye instruction-icon icon-target"></i><span>Follow the steps exactly as shown in the video</span></li> <li><i class="fa-solid fa-triangle-exclamation instruction-icon icon-warning"></i><span>Keep your generated key secure and private</span></li> </ul>
        </div>
    </div>
    
    <!-- Success Page -->
    <div class="success-page-container" id="successPage">
        <div class="success-card">
            <i class="fas fa-check-circle success-icon"></i> <h2>Key Generated!</h2>
            <p>Copy this key and paste it on our courses website to get access.</p>
            <div class="access-key-box" id="accessKeyBox">Generating...</div>
            <button class="copy-button" id="copyButton"> <i class="fas fa-copy"></i> <span id="copyButtonText">Copy Key</span> </button>
            <p class="expiry-note" id="expiryNote">This key is valid for one-time use.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, set, get, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

        particlesJS('particles-js', { particles: { number: { value: 60 }, color: { value: "#ffffff" }, opacity: { value: 0.3 }, size: { value: 2 }, move: { speed: 1 } } });
        
        // ==========================================================
        // === CONFIGURATION: WOHI FIREBASE DETAILS JO AAPNE DI THI ===
        // ==========================================================
        const firebaseConfig = {
            apiKey: "AIzaSyChwpbFb6M4HtG6zwjg0AXh7Lz9KjnrGZk",
            authDomain: "adminneast.firebaseapp.com",
            databaseURL: "https://adminneast-default-rtdb.firebaseio.com",
            projectId: "adminneast",
            storageBucket: "adminneast.appspot.com",
            messagingSenderId: "883877553418",
            appId: "1:883877553418:web:84ce8200f4b471bfffc6f3"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        
        // Settings ka path Firebase mein
        const settingsRef = ref(db, 'key_generator_settings/config');

        const generatorPage = document.getElementById('generatorPage');
        const successPage = document.getElementById('successPage');
        
        // Default settings, agar Firebase se data na mile toh
        let settings = {
            shortenerUrl: "#",
            tutorialUrl: "#",
            keyValidityMinutes: 10
        };

        // Page load hone par saara logic chalao
        async function initializePage() {
            // Step 1: Firebase se settings fetch karo
            try {
                const snapshot = await get(settingsRef);
                if (snapshot.exists()) {
                    settings = snapshot.val();
                } else {
                    console.warn("No settings found in Firebase. Using default values.");
                }
            } catch (error) {
                console.error("Error fetching settings:", error);
            }
            
            // Step 2: UI update karo
            document.getElementById('validityDisplay').textContent = `${settings.keyValidityMinutes} Minutes`;
            document.getElementById('tutorialLink').setAttribute('href', settings.tutorialUrl);
            
            // Step 3: Page ka content dikhao
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('status') === 'success') {
                showSuccessPage();
            } else {
                showGeneratorPage();
            }
        }

        function showGeneratorPage() {
            generatorPage.style.display = 'block';
            document.getElementById('generateButton').addEventListener('click', () => {
                window.location.href = settings.shortenerUrl;
            });
        }

        function showSuccessPage() {
            successPage.style.display = 'block';
            const newKey = generateAccessKey();
            document.getElementById('accessKeyBox').textContent = newKey;
            document.getElementById('expiryNote').textContent = `This key is valid for one-time use and will expire in ${settings.keyValidityMinutes} minutes.`;

            const keyRef = ref(db, 'access_keys/' + newKey);
            set(keyRef, {
                used: false,
                createdAt: serverTimestamp()
            }).catch((error) => console.error("Error saving key: ", error));

            document.getElementById('copyButton').addEventListener('click', () => {
                navigator.clipboard.writeText(newKey).then(() => {
                    const copyBtnText = document.getElementById('copyButtonText');
                    copyBtnText.textContent = 'Copied!';
                    setTimeout(() => { copyBtnText.textContent = 'Copy Key'; }, 2000);
                });
            });
        }

        function generateAccessKey(length = 15) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // Start the process
        initializePage();

    </script>
</body>
</html>
